import * as db from '../db';import * as sockets from '../sockets';import { xhrRequest } from '../utils';const isBrowser = process.browser;export function connectStoreToServer(Store, { user_id, config }) {  /* ----------------------------------------------------------------------------------------------    Initialize db && sockets  ---------------------------------------------------------------------------------------------- */  const { siteUrl, socketUrl } = config;  Store.utils.xhrRequest = xhrRequest({ siteUrl });  if (isBrowser) {  /* ----------------------------------------------------------------------------------------------    Initialize sockets  ---------------------------------------------------------------------------------------------- */    const { sendJSON } = sockets.initSocket({      socketUrl,      user_id,      onMessage: sockets.onMessage(Store),    });    Store.sockets = {      sendJSON,    };  /* ----------------------------------------------------------------------------------------------    Initialize db  ---------------------------------------------------------------------------------------------- */    Store.db = {      data: null, // already transformed and living free after initialization      query: db.query(Store),    };    return new Promise((resolve, reject) => {      db.start({ name: 'asyncDB', version: 1, user_id })      .then(db.hydrate(Store))      .then(resolve)      .catch(reject);    });  }}